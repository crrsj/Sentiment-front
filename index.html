<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Sentimento - Frontend</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                
                <header class="text-center mb-4">
                    <h1 class="display-4 text-primary">Analisador de Sentimento</h1>
                    <p class="lead">Insira um comentário para classificá-lo como Positivo, Negativo ou Neutro.</p>
                </header>

                <main class="card shadow-lg p-4">
                    <div class="mb-3">
                        <label for="commentInput" class="form-label fw-bold">Seu Comentário:</label>
                        <textarea class="form-control" id="commentInput" rows="4" placeholder="Digite seu texto aqui..."></textarea>
                    </div>

                    <button type="button" class="btn btn-primary btn-lg w-100" onclick="analyzeSentiment()">
                        Classificar Sentimento
                    </button>
                    
                    <hr class="my-4">

                    <h5 class="text-center mb-3">Resultado da Análise:</h5>
                    <div id="resultContainer" class="p-3 border rounded text-center">
                        <p class="mb-0 text-muted" id="sentimentResult">Aguardando análise...</p>
                    </div>
                </main>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // A função que chamaremos ao clicar no botão
        async function analyzeSentiment() {
            const commentInput = document.getElementById('commentInput');
            const resultContainer = document.getElementById('resultContainer');
            const sentimentResult = document.getElementById('sentimentResult');
            
            const comment = commentInput.value.trim();

            if (comment === "") {
                sentimentResult.textContent = "Por favor, insira um texto para análise.";
                resultContainer.className = "p-3 border rounded text-center bg-warning-subtle text-warning-emphasis";
                return;
            }

            // URL da sua API Spring Boot
            const apiUrl = 'http://localhost:8080/api/sentimento'; 
            
            // 1. Mostrar estado de carregamento
            sentimentResult.textContent = "Analisando...";
            resultContainer.className = "p-3 border rounded text-center bg-info-subtle text-info-emphasis";

            try {
                // 2. Chamada à API usando a Fetch API
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        // O Spring Boot espera que o corpo da requisição seja o texto puro,
                        // mas se você tivesse usado um DTO, usaria 'Content-Type': 'application/json'
                        'Content-Type': 'text/plain' 
                    },
                    body: comment // O corpo da requisição é o texto puro
                });

                // Verifica se a resposta foi bem-sucedida (código 200-299)
                if (!response.ok) {
                    throw new Error(`Erro HTTP! Status: ${response.status}`);
                }

                const data = await response.json(); // Pega o JSON de resposta da API
                const classification = data.classificacao;
                
                // 3. Exibir o resultado
                sentimentResult.textContent = `Resultado: ${classification}`;
                
                // Atualizar o estilo do container baseado na classificação
                updateResultStyle(classification, resultContainer);

            } catch (error) {
                console.error('Erro ao chamar a API:', error);
                sentimentResult.textContent = `Erro: Não foi possível conectar à API. Verifique se o Spring Boot está rodando em http://localhost:8080.`;
                resultContainer.className = "p-3 border rounded text-center bg-danger-subtle text-danger-emphasis";
            }
        }
        
        // Função auxiliar para aplicar estilos baseados no resultado
        function updateResultStyle(classification, container) {
            let className = "p-3 border rounded text-center";
            
            if (classification === "Positivo") {
                className += " bg-success-subtle text-success-emphasis";
            } else if (classification === "Negativo") {
                className += " bg-danger-subtle text-danger-emphasis";
            } else { // Neutro ou qualquer outro
                className += " bg-secondary-subtle text-secondary-emphasis";
            }
            
            container.className = className;
        }
    </script>
</body>
</html>